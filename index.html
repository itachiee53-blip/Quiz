<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Science Quiz: ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏•‡∏° (Online)</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Sarabun:wght@400;700;800&display=swap');

        :root {
            --bg-color: #5c94fc; 
            --ground-base: #c84c0c; 
            --panel-bg: rgba(20, 20, 35, 0.95); 
        }

        body {
            margin: 0; padding: 0; background-color: #050510; 
            font-family: 'Sarabun', sans-serif;
            display: flex; justify-content: center; align-items: center;
            height: 100vh; width: 100vw; overflow: hidden;
            user-select: none;
        }

        #app-wrapper {
            position: relative;
            background-color: #111;
            overflow: hidden;
            width: 800px; height: 600px; 
            border: 4px solid #333;
            border-radius: 12px;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            transform-origin: center center;
        }

        /* --- Responsive Fix --- */
        @media (max-width: 1024px) {
            #app-wrapper {
                width: 100% !important; height: 100% !important;
                border: none !important; border-radius: 0 !important;
                transform: none !important; box-shadow: none !important;
            }
            .pixel-panel { width: 90% !important; padding: 25px 15px !important; }
            h1 { font-size: 26px !important; margin-bottom: 20px !important; }
            .btn { font-size: 20px !important; padding: 15px !important; width: 100%; margin: 8px 0 !important;}
            .input-group label { font-size: 20px !important; }
            #question-text { font-size: 20px !important; min-height: auto !important; margin: 15px 0 !important; }
            .option-btn { font-size: 16px !important; padding: 12px !important; }
            #scene { height: 35% !important; flex-grow: 0 !important; }
            #quiz-section { height: 65% !important; justify-content: center !important; padding-bottom: 30px !important; }
        }

        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column; color: white; z-index: 100;
        }

        .pixel-panel {
            background: var(--panel-bg); border: 4px solid #fff;
            padding: 40px 30px; text-align: center;
            box-shadow: inset 6px 6px 0px rgba(255,255,255,0.1), inset -6px -6px 0px rgba(0,0,0,0.5), 10px 10px 0px rgba(0,0,0,0.5);
            border-radius: 16px; backdrop-filter: blur(10px); position: relative;
        }

        .corner-deco { position: absolute; width: 15px; height: 15px; background: #ffcc00; border: 2px solid #000; }
        .tl { top: -6px; left: -6px; } .tr { top: -6px; right: -6px; }
        .bl { bottom: -6px; left: -6px; } .br { bottom: -6px; right: -6px; }

        h1 { font-family: 'Sarabun', sans-serif; font-weight: 800; color: #ffcc00; font-size: 36px; margin-top: 0; text-align: center; text-shadow: none; margin-bottom: 10px;}
        h2 { font-family: 'Sarabun', sans-serif; font-weight: 800; color: #fff; font-size: 24px; text-align: center; text-shadow: none; margin-top: 0; }

        .input-group { margin-bottom: 25px; text-align: center; position: relative; }
        .input-group label { font-family: 'Sarabun', sans-serif; font-size: 22px; display: block; margin-bottom: 10px; font-weight: 700; color: #aaddff; text-shadow: none; letter-spacing: 0.5px; }
        .pixel-input { font-family: 'Sarabun', sans-serif; font-size: 18px; font-weight: bold; padding: 12px; text-align: center; border: 3px solid #555; outline: none; width: 70%; background-color: #fff; color: #333; box-shadow: inset 2px 2px 5px rgba(0,0,0,0.2); border-radius: 8px; transition: all 0.2s; }
        .pixel-input:focus { border-color: #ffcc00; transform: scale(1.02); }

        .btn { background-color: #e52521; color: white; border: none; border-bottom: 5px solid #990000; padding: 12px 30px; font-size: 20px; font-family: 'Sarabun', sans-serif; font-weight: 800; cursor: pointer; margin: 10px; border-radius: 10px; transition: all 0.1s; position: relative; top: 0; }
        .btn:hover:not(:disabled) { filter: brightness(1.1); top: -2px; border-bottom-width: 7px; }
        .btn:active:not(:disabled) { top: 3px; border-bottom-width: 2px; transform: scale(0.98); }
        .btn-green { background-color: #4CAF50; border-bottom-color: #2E7D32; }
        .btn-yellow { background-color: #ffcc00; color: #333; border-bottom-color: #c49000; }
        .btn:disabled { background-color: #555; border-bottom-color: #333; cursor: not-allowed; color: #888; top: 0; }

        .animated-bg { background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e); background-size: 400% 400%; animation: gradientBG 15s ease infinite; }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        #lobby-container { flex-grow: 1; width: 90%; margin: 15px auto; background: rgba(0,0,0,0.4); border: 2px solid rgba(255,255,255,0.3); padding: 15px; overflow-y: auto; border-radius: 10px; }
        #lobby-players { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; }
        .player-card { background-color: #fff; border: 2px solid #000; padding: 10px; font-size: 14px; font-weight: bold; color: #000; text-align: center; border-radius: 8px; box-shadow: 4px 4px 0px rgba(0,0,0,0.2); display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px; }
        .player-card.is-me { border: 2px solid #ffcc00; background-color: #fff8e1; color: #d84315; }

        #screen-leaderboard { background: radial-gradient(circle, #2b1055 0%, #000000 100%); overflow-y: auto;}
        #podium-container { display: flex; justify-content: center; align-items: flex-end; gap: 10px; margin-top: 40px; margin-bottom: 20px; height: 220px; flex-shrink: 0; }
        .podium-col { width: 30%; display: flex; flex-direction: column; align-items: center; }
        .podium-medal { font-size: 40px; margin-bottom: 5px; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5)); animation: floatMedal 3s ease-in-out infinite; }
        @keyframes floatMedal { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .podium-name { font-weight: bold; font-size: 14px; margin-bottom: 5px; color: #fff; text-shadow: 2px 2px 0 #000; background: rgba(0,0,0,0.6); padding: 2px 8px; border-radius: 4px; white-space: nowrap; max-width: 100%; overflow: hidden; text-overflow: ellipsis; }
        .podium-score { font-family: 'Press Start 2P'; font-size: 10px; color: #ffcc00; margin-bottom: 5px; }
        .podium-box { width: 100%; border: 3px solid rgba(255,255,255,0.3); border-bottom: none; border-radius: 10px 10px 0 0; display: flex; justify-content: center; align-items: center; position: relative; overflow: hidden; }
        .podium-rank-text { font-family: 'Press Start 2P'; color: rgba(255,255,255,0.8); font-size: 30px; mix-blend-mode: overlay; }
        .rank-1 { height: 120px; background: linear-gradient(to top, #ffb300, #ffe082); border-color: #ffe082; box-shadow: 0 0 20px rgba(255, 215, 0, 0.4); z-index: 10;}
        .rank-1::after { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(to right, transparent, rgba(255,255,255,0.8), transparent); transform: rotate(45deg); animation: shine 3s infinite; }
        @keyframes shine { 0% { left: -100%; top: -100%; } 100% { left: 100%; top: 100%; } }
        .rank-2 { height: 90px; background: linear-gradient(to top, #757575, #bdbdbd); z-index: 5; }
        .rank-3 { height: 60px; background: linear-gradient(to top, #8d6e63, #d7ccc8); z-index: 5; }

        #leaderboard-scroll { width: 95%; flex-grow: 1; margin: 0 auto 15px auto; overflow-y: auto; border: 2px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.6); border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        #leaderboard-table { width: 100%; border-collapse: collapse; }
        #leaderboard-table th { background: rgba(255,255,255,0.15); color: #ffcc00; font-family: 'Sarabun', sans-serif; font-weight: 800; font-size: 14px; padding: 10px 5px; position: sticky; top: 0; backdrop-filter: blur(5px); text-align: center !important; }
        #leaderboard-table td { padding: 10px 5px; font-size: 14px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); color: #fff; }
        #leaderboard-table td:nth-child(2) { text-align: left; padding-left: 15px; }
        .me-row { background: rgba(76, 175, 80, 0.4); color: #fff !important; font-weight: bold; border-left: 4px solid #4CAF50; }

        #confetti-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; }

        #game-container { width: 100%; height: 100%; background-color: var(--bg-color); position: relative; display: flex; flex-direction: column; transition: background-color 0.5s ease; }
        .shake-damage { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(4px, 0, 0); background-color: #ffcccc; } 30%, 50%, 70% { transform: translate3d(-8px, 0, 0); } 40%, 60% { transform: translate3d(8px, 0, 0); background-color: #ff4444; } }
        #header { display: flex; justify-content: space-between; padding: 15px; font-family: 'Press Start 2P', cursive; color: white; text-shadow: 2px 2px 0 #000; font-size: 12px; z-index: 5; flex-shrink: 0;}
        .header-item { text-align: center; line-height: 1.5; }
        .time-warning { color: #ff4444 !important; animation: blink 0.5s infinite; text-shadow: 2px 2px 0 #000; }
        @keyframes blink { 50% { opacity: 0; } }
        
        .cloud { position: absolute; font-size: 60px; color: rgba(255, 255, 255, 0.8); text-shadow: 2px 2px 0px rgba(0,0,0,0.2); animation: moveClouds linear infinite; z-index: 1; }
        #cloud1 { top: 40px; left: -100px; animation-duration: 25s; } #cloud2 { top: 100px; left: -200px; animation-duration: 35s; font-size: 40px;} #cloud3 { top: 20px; left: -300px; animation-duration: 20s; font-size: 80px;}
        @keyframes moveClouds { from { transform: translateX(-100px); } to { transform: translateX(1000px); } }
        
        #scene { flex-grow: 1; position: relative; width: 100%; overflow: hidden; }
        
        #ground { position: absolute; bottom: 0; width: 100%; height: 50px; background-color: var(--ground-base); border-top: 4px solid #000; background-image: linear-gradient(45deg, #fc9838 25%, transparent 25%, transparent 75%, #fc9838 75%, #fc9838), linear-gradient(45deg, #fc9838 25%, transparent 25%, transparent 75%, #fc9838 75%, #fc9838); background-size: 20px 20px; background-position: 0 0, 10px 10px; transition: all 0.5s ease; z-index: 3; }
        #character { position: absolute; bottom: 50px; left: 50px; width: 60px; height: 80px; background-image: url('mario_idle.jpg'); background-size: cover; background-position: center; background-repeat: no-repeat; z-index: 4; }
        #character.jumping-state { background-image: url('mario_jump.jpg') !important; }
        @keyframes walkingAnim { 0%, 49% { background-image: url('mario_idle.jpg'); } 50%, 100% { background-image: url('mario_walk.jpg'); } }
        #character.walking-state { animation: walkingAnim 0.3s infinite; }
        
        #obstacle { position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); width: 50px; height: 50px; z-index: 2; transition: opacity 0.3s; }
        .obs-block { background-color: #fc9838; border: 2px solid #000; box-shadow: inset -4px -4px 0px rgba(0,0,0,0.3); display: flex; justify-content: center; align-items: center; font-weight: bold; font-family: 'Press Start 2P', cursive; color: #fff; bottom: 160px !important; border-radius: 0 !important; }
        .obs-block.hit { background-color: #8b4513; } 
        .obs-goomba { background-color: #8b4513; border-radius: 10px 10px 0 0; border: 2px solid #000; }
        .obs-pipe { background-color: #00aa00; width: 60px !important; height: 80px !important; border: 2px solid #000; border-top: 10px solid #00ff00; }
        .obs-stone { background-color: #555; border: 2px solid #000; box-shadow: inset 4px 4px 0 #888; }
        .obs-boss { background-color: #ff0000; width: 80px !important; height: 100px !important; border-radius: 20px 20px 0 0; border: 3px solid #000; background-image: repeating-linear-gradient(45deg, transparent, transparent 10px, #8b0000 10px, #8b0000 20px); }
        .squished { transform: scaleY(0.3); transform-origin: bottom; opacity: 0.5; }
        
        #coin { position: absolute; bottom: 120px; left: 50%; transform: translateX(-50%); width: 30px; height: 30px; background-color: gold; border-radius: 50%; border: 2px solid #000; display: none; justify-content: center; align-items: center; font-weight: bold; color: #d4af37; z-index: 1; }
        .float-text { position: absolute; bottom: 150px; left: 50%; transform: translateX(-50%); color: #fff; font-family: 'Press Start 2P', cursive; font-size: 20px; text-shadow: 2px 2px 0px #000; z-index: 10; display: none; animation: floatUp 1s ease-out forwards; }
        @keyframes floatUp { 0% { transform: translate(-50%, 0) scale(1); opacity: 1; } 50% { transform: translate(-50%, -40px) scale(1.2); opacity: 1; } 100% { transform: translate(-50%, -80px) scale(1); opacity: 0; } }
        @keyframes popUpCoin { 0% { bottom: 120px; opacity: 1; transform: translate(-50%, 0) scale(1); } 50% { bottom: 200px; opacity: 1; transform: translate(-50%, 0) scale(1.2); } 100% { bottom: 250px; opacity: 0; transform: translate(-50%, 0) scale(1); } }
        .coin-pop { display: flex !important; animation: popUpCoin 0.6s ease-out forwards; }
        @keyframes popUpCoinBlock { 0% { bottom: 160px; opacity: 1; transform: translate(-50%, 0) scale(1); } 50% { bottom: 240px; opacity: 1; transform: translate(-50%, 0) scale(1.2); } 100% { bottom: 290px; opacity: 0; transform: translate(-50%, 0) scale(1); } }
        .coin-pop-block { display: flex !important; animation: popUpCoinBlock 0.6s ease-out forwards; }

        #quiz-section { background-color: rgba(0, 0, 0, 0.95); color: white; padding: 15px; min-height: auto; border-top: 4px solid #fff; z-index: 10; display: flex; flex-direction: column; justify-content: center; box-shadow: 0 -5px 20px rgba(0,0,0,0.5); flex-shrink: 0; }
        #timer-bar-container { width: 100%; height: 10px; background-color: #222; border: 2px solid #555; border-radius: 10px; margin-bottom: 10px; box-shadow: inset 0 2px 4px rgba(0,0,0,0.8); overflow: hidden; flex-shrink: 0; }
        #timer-bar { height: 100%; width: 100%; background-color: #4CAF50; border-radius: 8px; transition: width 1s linear, background-color 0.5s ease; box-shadow: inset 0 2px 0 rgba(255,255,255,0.3); }
        #question-text { font-size: 20px; margin-bottom: 10px; text-align: center; min-height: 50px; font-weight: bold; text-shadow: 1px 1px 0 #000; display: flex; align-items: center; justify-content: center; }
        #options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; flex-grow: 1; margin-bottom: 5px;}
        .option-btn { background-color: #f0f0f0; color: #111; border: none; border-bottom: 5px solid #aaa; padding: 12px; font-size: 18px; font-family: 'Sarabun', sans-serif; font-weight: 800; cursor: pointer; border-radius: 10px; transition: all 0.1s; }
        .option-btn:hover:not(:disabled) { transform: translateY(-2px); filter: brightness(0.95); border-bottom-width: 7px; }
        .option-btn:active:not(:disabled) { transform: translateY(3px); border-bottom-width: 2px; }
        .option-btn:disabled { opacity: 0.7; cursor: not-allowed; transform: none; border-bottom-width: 5px;}
        #question-image { max-height: 100px; max-width: 100%; border: 2px solid #fff; border-radius: 8px; margin-bottom: 5px; display: none; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
    </style>
</head>
<body>

    <div id="app-wrapper">
        <canvas id="confetti-canvas"></canvas>

        <div id="screen-main" class="screen animated-bg" style="display: flex; justify-content: center; align-items: center;">
            <div class="pixel-panel" style="width: 80%;">
                <div class="corner-deco tl"></div><div class="corner-deco tr"></div>
                <div class="corner-deco bl"></div><div class="corner-deco br"></div>
                <h1>SCIENCE QUIZ<br><span style="font-size: 20px; color:#fff;">‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏•‡∏°</span></h1>
                <div class="input-group">
                    <label>üë§ ‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</label>
                    <input type="text" id="player-name" class="pixel-input" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." maxlength="12">
                </div>
                <div>
                    <button class="btn btn-green" onclick="showCreateRoom()">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á</button>
                    <button class="btn btn-yellow" onclick="showJoinRoom()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</button>
                </div>
            </div>
        </div>

        <div id="screen-create" class="screen animated-bg" style="justify-content: center; align-items: center;">
            <div class="pixel-panel" style="width: 70%;">
                <div class="corner-deco tl"></div><div class="corner-deco tr"></div>
                <div class="corner-deco bl"></div><div class="corner-deco br"></div>
                <h2 style="color: #4CAF50; margin-bottom: 25px;">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏°</h2>
                <div class="input-group">
                    <label>üë• ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</label>
                    <input type="number" id="room-max" class="pixel-input" min="2" max="30" value="30" style="width: 40%;">
                </div>
                <button class="btn btn-green" onclick="createRoom()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                <button class="btn" onclick="showScreen('screen-main')">‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>

        <div id="screen-join" class="screen animated-bg" style="justify-content: center; align-items: center;">
            <div class="pixel-panel" style="width: 70%;">
                <div class="corner-deco tl"></div><div class="corner-deco tr"></div>
                <div class="corner-deco bl"></div><div class="corner-deco br"></div>
                <h2 style="color: #ffcc00; margin-bottom: 25px;">üîë ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</h2>
                <div class="input-group">
                    <label>‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á 5 ‡∏´‡∏•‡∏±‡∏Å</label>
                    <input type="text" id="room-code-input" class="pixel-input" placeholder="XXXXX" maxlength="5" style="width: 50%;">
                </div>
                <button class="btn btn-yellow" onclick="joinRoom()">‡∏•‡∏∏‡∏¢‡πÄ‡∏•‡∏¢!</button>
                <button class="btn" onclick="showScreen('screen-main')">‡∏Å‡∏•‡∏±‡∏ö</button>
            </div>
        </div>

        <div id="screen-lobby" class="screen animated-bg" style="padding-top: 30px;">
            <div style="text-align: center;">
                <h2 style="margin-bottom: 10px; font-size: 20px;">‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á</h2>
                <div style="font-size: 40px; font-family: 'Press Start 2P'; color: #ffcc00; text-shadow: 4px 4px 0 rgba(0,0,0,0.5); margin-bottom: 10px; letter-spacing: 5px;" id="display-room-code">-----</div>
                <p style="font-size: 18px; font-weight: bold; text-shadow: 1px 1px 0 #000; color: #aaa;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô... (<span id="player-count" style="color:#fff">0</span>/<span id="player-max">30</span>)</p>
            </div>
            <div id="lobby-container"><div id="lobby-players"></div></div>
            <div style="text-align: center; margin-bottom: 30px;">
                <button id="btn-start-game" class="btn btn-green" disabled onclick="startGameSignal()" style="font-size: 22px; padding: 15px 60px;">‡∏£‡∏≠‡∏´‡∏±‡∏ß‡∏´‡πâ‡∏≠‡∏á...</button>
                <button class="btn" onclick="location.reload()">‡∏≠‡∏≠‡∏Å</button>
            </div>
        </div>

        <div id="screen-game" class="screen">
            <div id="game-container">
                <div id="cloud1" class="cloud">‚òÅÔ∏è</div> <div id="cloud2" class="cloud">‚òÅÔ∏è</div> <div id="cloud3" class="cloud">‚òÅÔ∏è</div>
                <div id="header">
                    <div class="header-item">SCORE<br><span id="score">00</span></div> 
                    <div class="header-item">TIME<br><span id="time" style="color:white;">15</span></div>
                    <div class="header-item">WORLD<br><span id="world">1-1</span></div>
                    <div class="header-item">LIVES<br><span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></div> <div class="header-item">Q<br><span id="q-num">1</span>/20</div>
                </div>
                <div id="scene">
                    <div id="obstacle" class="obs-block">?</div>
                    <div id="coin">$</div>
                    <div id="floating-score" class="float-text">+1</div>
                    <div id="character"></div>
                    <div id="ground"></div>
                </div>
                <div id="quiz-section">
                    <div id="timer-bar-container"><div id="timer-bar"></div></div>
                    <div style="text-align: center;"><img id="question-image" src="" alt="Question Image"></div>
                    <div id="question-text">‡∏£‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°...</div>
                    <div id="options"></div>
                </div>
            </div>
        </div>

        <div id="screen-waiting" class="screen animated-bg" style="justify-content: center; align-items: center;">
            <div class="pixel-panel" style="width: 70%;">
                <h2 style="color: #ffcc00; margin-bottom: 15px;">‚è≥ ‡∏™‡πà‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô...</h2>
                <p style="font-size: 18px; margin-bottom: 25px; color: #ddd;">‡∏£‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏ö‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</p>
                <div style="width: 100%; height: 25px; background: #222; border: 3px solid #fff; border-radius: 12px; overflow: hidden; box-shadow: inset 0 0 10px #000;">
                    <div id="waiting-progress" style="width: 100%; height: 100%; background: linear-gradient(90deg, #4CAF50, #8BC34A); animation: pulse 1s infinite;"></div>
                </div>
                <button class="btn" onclick="calculateAndShowLeaderboard()" style="margin-top:20px;">‡∏î‡∏π‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏î‡πâ‡∏á)</button>
            </div>
        </div>

        <div id="screen-leaderboard" class="screen" style="padding-top: 20px;">
            <h1 style="font-size: 28px; margin-bottom: 5px; color: #ffcc00;">üèÜ ‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö üèÜ</h1>
            <p id="end-status-msg" style="text-align: center; font-size: 18px; font-weight: bold; margin-bottom: 5px; text-shadow: 2px 2px 0 #000; min-height: 25px; color: #fff;"></p>
            <div id="podium-container">
                <div class="podium-col" style="justify-content: flex-end;">
                    <div class="podium-medal">ü•à</div>
                    <div class="podium-name" id="pod-name-2">---</div>
                    <div class="podium-score" id="pod-score-2">0</div>
                    <div class="podium-box rank-2"><span class="podium-rank-text">2</span></div>
                </div>
                <div class="podium-col">
                    <div class="podium-medal" style="font-size: 55px; color: #ffd700;">ü•á</div>
                    <div class="podium-name" id="pod-name-1" style="color:#ffcc00; border: 1px solid #ffd700;">---</div>
                    <div class="podium-score" id="pod-score-1" style="color:#ffcc00; font-size: 16px;">0</div>
                    <div class="podium-box rank-1"><span class="podium-rank-text">1</span></div>
                </div>
                <div class="podium-col" style="justify-content: flex-end;">
                    <div class="podium-medal">ü•â</div>
                    <div class="podium-name" id="pod-name-3">---</div>
                    <div class="podium-score" id="pod-score-3">0</div>
                    <div class="podium-box rank-3"><span class="podium-rank-text">3</span></div>
                </div>
            </div>
            <div id="leaderboard-scroll">
                <table id="leaderboard-table">
                    <thead><tr><th style="width: 15%;">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</th><th style="width: 45%;">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</th><th style="width: 15%;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th><th style="width: 25%;">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</th></tr></thead>
                    <tbody id="leaderboard-body"></tbody>
                </table>
            </div>
            <div style="text-align: center; margin-bottom: 15px;">
                <button class="btn btn-yellow" onclick="location.reload()" style="font-size: 18px; padding: 12px 30px;">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
            </div>
        </div>
    </div>

    <script>
        // --- üî¥ CONFIG FIREBASE ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô! üî¥ ---
        const firebaseConfig = {
          apiKey: "AIzaSyDBKT3HSjfq_ZmYvDg23uWA-6VjWfsr5-Q",
          authDomain: "quiz-a5052.firebaseapp.com",
          databaseURL: "https://quiz-a5052-default-rtdb.firebaseio.com",
          projectId: "quiz-a5052",
          storageBucket: "quiz-a5052.firebasestorage.app",
          messagingSenderId: "533017298833",
          appId: "1:533017298833:web:72e496476babf871773c30",
          measurementId: "G-CBDNGEX2H3"
        };
        // -----------------------------------------------------------

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        // Responsive Function
        function resizeApp() {
            const wrapper = document.getElementById('app-wrapper');
            const windowWidth = window.innerWidth;
            if (windowWidth <= 1024) {
                wrapper.style.transform = 'none'; wrapper.style.width = '100%'; wrapper.style.height = '100%';
                return;
            }
            const windowHeight = window.innerHeight;
            const scaleX = windowWidth / 800;
            const scaleY = windowHeight / 600;
            const scale = Math.min(scaleX, scaleY) * 0.98; 
            wrapper.style.transform = `scale(${scale})`;
        }
        window.addEventListener('resize', resizeApp);
        resizeApp();

        let myName = ""; let isHost = false; let roomCode = ""; 
        let myKey = ""; 
        let playerList = []; 
        let gameStartTime = 0;
        let gameQuestions = []; 
        // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô 6 ‡∏î‡∏ß‡∏á
        let lives = 6; 

        const avatarIcons = ["üê∂","üê±","üê≠","üêπ","üê∞","ü¶ä","üêª","üêº","üê®","üêØ","ü¶Å","üêÆ","üê∑","üê∏","üêµ","üê£","ü¶Ü","ü¶â","ü¶Ñ","ü¶Ä","ü¶ë","üêô","ü¶ã","üêå","üêû","üêú","üê¢","üêç","üê≥","üê¨","üçé","üçê","üçä","üçã","üçå","üçâ","üçá","üçì","üçà","üçí","üçë","üçç","ü•ù","ü•ë","üçÖ","üçÜ","ü•í","ü•ï","üåΩ","üå∂","ü•¶","üçÑ","ü•ú","üå∞","üçû","ü•ê","ü•ñ","ü•®","ü•û","üßÄ","üçñ","üçó","ü•©","ü•ì","üçî","üçü","üçï","üå≠","ü•™","üåÆ","üçú","üçù","üçô","üçö","üçõ","üç£","üç±","ü•ü","üç§","üç¶"];

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
            document.getElementById(screenId).style.display = 'flex';
        }

        function getMyName() {
            let nameInput = document.getElementById('player-name').value.trim();
            return nameInput !== "" ? nameInput : "‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô" + Math.floor(Math.random()*100);
        }

        function showCreateRoom() { myName = getMyName(); showScreen('screen-create'); }
        function showJoinRoom() { myName = getMyName(); showScreen('screen-join'); }

        function createRoom() {
            roomCode = Math.floor(10000 + Math.random() * 90000).toString(); 
            isHost = true;
            let limit = parseInt(document.getElementById('room-max').value);
            
            db.ref('rooms/' + roomCode).set({
                status: 'waiting',
                maxPlayers: limit,
                createdAt: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                joinLobby();
            });
        }

        function joinRoom() {
            let code = document.getElementById('room-code-input').value;
            if(code.length === 5) {
                roomCode = code;
                isHost = false;
                db.ref('rooms/' + roomCode).once('value', (snapshot) => {
                    if (snapshot.exists()) {
                        let data = snapshot.val();
                        if(data.status === 'waiting') {
                            joinLobby();
                        } else {
                            alert("‡πÄ‡∏Å‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡∏´‡∏£‡∏∑‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡πá‡∏°!");
                        }
                    } else {
                        alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ!");
                    }
                });
            } else { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á 5 ‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"); }
        }

// ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô joinLobby ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö
        function joinLobby() {
            showScreen('screen-lobby');
            document.getElementById('display-room-code').innerText = roomCode;
            
            db.ref('rooms/' + roomCode + '/maxPlayers').once('value', (snapshot) => {
                if(snapshot.exists()) {
                    document.getElementById('player-max').innerText = snapshot.val();
                }
            });

            let randomIcon = avatarIcons[Math.floor(Math.random() * avatarIcons.length)];
            let newPlayerRef = db.ref('rooms/' + roomCode + '/players').push();
            myKey = newPlayerRef.key;
            
            // --- üî¥ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏∏‡∏î/‡∏õ‡∏¥‡∏î‡πÅ‡∏ó‡πá‡∏ö ---
            newPlayerRef.onDisconnect().remove(); 
            // ---------------------------------------------------------

            newPlayerRef.set({
                name: myName,
                icon: randomIcon,
                score: 0,
                timeUsed: 0,
                status: 'waiting'
            });

            db.ref('rooms/' + roomCode + '/players').on('value', (snapshot) => {
                playerList = [];
                let html = "";
                let count = 0;
                
                // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡∏£‡∏∂‡∏¢‡∏±‡∏á
                let allFinished = true;
                let hasPlayers = false;

                snapshot.forEach((childSnapshot) => {
                    hasPlayers = true;
                    let p = childSnapshot.val();
                    let isMe = (childSnapshot.key === myKey);
                    playerList.push({...p, key: childSnapshot.key});
                    count++;
                    html += `<div class="player-card ${isMe ? 'is-me' : ''}">
                                <span style="font-size:24px;">${p.icon}</span> 
                                <span style="display:block; margin-top:5px;">${p.name}</span>
                                <span style="font-size:10px; color:${p.status === 'waiting' ? '#aaa' : '#4CAF50'}">
                                    ${p.status === 'waiting' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô...' : '‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß'}
                                </span>
                             </div>`;
                    
                    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ô‡πÑ‡∏´‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô waiting ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏¢‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏°‡πà‡∏à‡∏ö
                    if (p.status === 'waiting') {
                        allFinished = false;
                    }
                });

                document.getElementById('player-count').innerText = count;
                document.getElementById('lobby-players').innerHTML = html;

                if(isHost) {
                    let btn = document.getElementById('btn-start-game');
                    // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ô‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏Ñ‡∏ô‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ (‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡πÅ‡∏Å‡πâ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ï‡∏≤‡∏°‡πÉ‡∏à‡∏ä‡∏≠‡∏ö)
                    if (count >= 1) {
                         btn.disabled = false; 
                         btn.innerText = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÄ‡∏•‡∏¢!";
                         btn.classList.add('shake-damage');
                         btn.onclick = startGameSignal;
                    } else {
                         btn.disabled = true;
                         btn.innerText = "‡∏£‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô...";
                    }
                }

                // --- üî¥ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 2: ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á ---
                // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô, ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà waiting, ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ screen-waiting
                // ‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πâ‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô
                let currentScreen = document.getElementById('screen-waiting').style.display;
                if (hasPlayers && allFinished && currentScreen === 'flex') {
                    calculateAndShowLeaderboard();
                }
                // ------------------------------------------------
            });

            db.ref('rooms/' + roomCode + '/status').on('value', (snapshot) => {
                if(snapshot.val() === 'playing') {
                    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏° ‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Lobby ‡πÑ‡∏õ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
                    // (‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ñ‡πâ‡∏≤‡πÄ‡∏ô‡πá‡∏ï‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡∏Å)
                    if (document.getElementById('screen-game').style.display === 'none') {
                        startGame();
                    }
                }
            });
        }

        function startGameSignal() {
            db.ref('rooms/' + roomCode).update({ status: 'playing' });
        }

        const sfxBGM = new Audio('bgm.mp3'); sfxBGM.loop = true; sfxBGM.volume = 0.4;
        const sfxJump = new Audio('jump.mp3'); const sfxCoin = new Audio('coin.mp3');
        const sfxDamage = new Audio('damage.mp3'); const sfxGameOver = new Audio('gameover.mp3');
        const sfxWin = new Audio('win.mp3');
        function playSound(sound) { sound.currentTime = 0; sound.play().catch(e => console.log("‡∏£‡∏≠")); }

        const questionsSource = [
            { q: "‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏ñ‡∏∂‡∏á ‚Äú‡∏•‡∏°‚Äù ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á", options: ["‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏ï‡∏≤‡∏°‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á", "‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏ï‡∏≤‡∏°‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á", "‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏ï‡πà‡∏≥‡πÑ‡∏õ‡∏™‡∏π‡∏á", "‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏™‡∏π‡∏á‡πÑ‡∏õ‡∏ï‡πà‡∏≥"], answer: 3 },
            { q: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏≤‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏π‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏µ‡πà‡πÄ‡∏°‡∏ï‡∏£‡∏à‡∏≤‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏î‡∏¥‡∏ô", options: ["20 ‡πÄ‡∏°‡∏ï‡∏£", "30 ‡πÄ‡∏°‡∏ï‡∏£", "40 ‡πÄ‡∏°‡∏ï‡∏£", "50 ‡πÄ‡∏°‡∏ï‡∏£"], answer: 3 },
            { q: "‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏°‡∏°‡∏µ‡∏Å‡∏µ‡πà‡∏ä‡∏ô‡∏¥‡∏î ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á", options: ["2 ‡∏ä‡∏ô‡∏¥‡∏î (‡πÅ‡∏Å‡∏ô‡∏ô‡∏≠‡∏ô, ‡πÅ‡∏Å‡∏ô‡∏ï‡∏±‡πâ‡∏á)", "2 ‡∏ä‡∏ô‡∏¥‡∏î (‡πÅ‡∏Å‡∏ô‡∏ô‡∏≠‡∏ô, ‡πÅ‡∏Å‡∏ô‡∏ï‡∏±‡πâ‡∏á)", "2 ‡∏ä‡∏ô‡∏¥‡∏î (‡πÅ‡∏Å‡∏ô‡∏ô‡∏≠‡∏ô, ‡πÅ‡∏Å‡∏ô‡∏ï‡∏±‡πâ‡∏á)", "2 ‡∏ä‡∏ô‡∏¥‡∏î (‡πÅ‡∏Å‡∏ô‡∏ï‡∏£‡∏á, ‡πÅ‡∏Å‡∏ô‡∏ï‡∏±‡πâ‡∏á)"], answer: 0 },
            { q: "‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏û‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÉ‡∏î", img: "wind.jpg", options: ["‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏°‡πÅ‡∏ô‡∏ß‡πÅ‡∏Å‡∏ô‡∏ô‡∏≠‡∏ô", "‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏°‡πÅ‡∏ô‡∏ß‡πÅ‡∏Å‡∏ô‡∏ï‡∏±‡πâ‡∏á", "‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏°‡πÅ‡∏ô‡∏ß‡πÅ‡∏Å‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏â‡∏≤‡∏Å", "‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏°‡πÅ‡∏ô‡∏ß‡πÅ‡∏Å‡∏ô‡∏ï‡∏£‡∏á"], answer: 0 },
            { q: "‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏°‡∏ô‡∏≥‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏≠‡∏∞‡πÑ‡∏£", options: ["‡∏ú‡∏•‡∏¥‡∏ï‡∏ô‡πâ‡∏≥", "‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏Å‡πä‡∏™", "‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏ü‡∏ü‡πâ‡∏≤", "‡∏ú‡∏•‡∏¥‡∏ï‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô"], answer: 2 },
            { q: "‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏•‡∏°‡πÉ‡∏ô‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏£", options: ["5-8 ‡πÄ‡∏°‡∏ï‡∏£‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ", "6-10 ‡πÄ‡∏°‡∏ï‡∏£‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ", "4-6 ‡πÄ‡∏°‡∏ï‡∏£‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ", "7-12 ‡πÄ‡∏°‡∏ï‡∏£‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ"], answer: 2 },
            { q: "‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏•‡∏°‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏Å‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£", options: ["‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏ô‡πâ‡∏≥", "‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏°", "‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡πÑ‡∏ü‡∏ü‡πâ‡∏≤", "‡∏ñ‡∏π‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠"], answer: 1 },
            { q: "‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏°", options: ["‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏°‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á", "‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏°‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô", "‡∏Å‡∏±‡∏ô‡∏´‡∏±‡∏ô‡∏•‡∏°‡πÄ‡∏â‡∏µ‡∏¢‡∏á", "‡∏ñ‡∏π‡∏Å‡∏ó‡∏±‡πà‡∏á‡∏Ç‡πâ‡∏≠ ‡∏Å. ‡πÅ‡∏•‡∏∞ ‡∏Ç."], answer: 2 },
            { q: "‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏•‡∏°‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡πÉ‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡πÉ‡∏î‡∏ö‡πâ‡∏≤‡∏á", options: ["‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÑ‡∏ü‡∏ü‡πâ‡∏≤", "‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ö‡∏ô‡πâ‡∏≥", "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ñ‡∏π‡∏Å", "‡∏ñ‡∏π‡∏Å‡∏ó‡∏±‡πà‡∏á‡∏Ç‡πâ‡∏≠ ‡∏Å ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠ ‡∏Ç"], answer: 3 },
            { q: "‡∏ù‡∏±‡πà‡∏á‡∏ó‡∏∞‡πÄ‡∏•‡∏≠‡∏±‡∏ô‡∏î‡∏≤‡∏°‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡πà‡∏≤‡∏ß‡πÑ‡∏ó‡∏¢ ‡∏°‡∏µ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏•‡∏°‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏î‡πâ‡∏≤‡∏ô‡πÉ‡∏î", options: ["‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏°‡∏™‡∏π‡∏ö‡∏ô‡πâ‡∏≥", "‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏™‡∏π‡∏ö‡∏ô‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏ü‡∏ü‡πâ‡∏≤", "‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏ú‡∏•‡∏¥‡∏ï‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÑ‡∏ü‡∏ü‡πâ‡∏≤", "‡∏ñ‡∏π‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠"], answer: 1 },
            { q: "‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÉ‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏´‡πà‡∏á‡πÅ‡∏£‡∏Å", options: ["‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ï‡∏£‡∏≤‡∏î", "‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", "‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", "‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏¢‡∏≠‡∏á"], answer: 1 },
            { q: "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏•‡∏°‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢", options: ["‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ô‡∏Ñ‡∏£‡∏´‡∏•‡∏ß‡∏á", "‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏†‡∏π‡∏°‡∏¥‡∏†‡∏≤‡∏Ñ", "‡∏Å‡∏£‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô", "‡∏Å‡∏ü‡∏ú. (EGAT)"], answer: 3 },
            { q: "‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡πÉ‡∏î‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏°", options: ["‡πÅ‡∏´‡∏•‡∏°‡∏û‡∏£‡∏´‡∏°‡πÄ‡∏ó‡∏û", "‡πÅ‡∏´‡∏•‡∏°‡∏™‡∏¥‡∏á‡∏´‡πå", "‡πÅ‡∏´‡∏•‡∏°‡πÅ‡∏ó‡πà‡∏ô", "‡πÅ‡∏´‡∏•‡∏°‡∏ï‡∏∞‡∏•‡∏∏‡∏°‡∏û‡∏∏‡∏Å"], answer: 0 },
            { q: "‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏°‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠", options: ["‡∏™‡∏´‡∏£‡∏±‡∏ê‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏≤", "‡πÄ‡∏î‡∏ô‡∏°‡∏≤‡∏£‡πå‡∏Å", "‡πÄ‡∏¢‡∏≠‡∏£‡∏°‡∏ô‡∏µ", "‡∏™‡πÄ‡∏õ‡∏ô"], answer: 2 },
            { q: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏° ‡∏Ñ‡∏∑‡∏≠‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡πÉ‡∏î", options: ["‡∏õ‡∏≤‡∏Å‡∏≠‡πà‡∏≤‡∏ß", "‡∏£‡∏¥‡∏°‡πÄ‡∏Ç‡∏∑‡πà‡∏≠‡∏ô", "‡∏£‡∏¥‡∏°‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡∏≤‡∏ö", "‡πÄ‡∏ô‡∏¥‡∏ô‡πÄ‡∏Ç‡∏≤, ‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏ä‡∏∏‡∏°‡∏ä‡∏ô"], answer: 3 },
            { q: "‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏Ç‡∏≠‡∏á‡∏•‡∏°‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏î‡πâ‡∏≤‡∏ô ‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡πÉ‡∏î", options: ["‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏á", "‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏µ‡∏¨‡∏≤", "‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå", "‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÑ‡∏ü‡∏ü‡πâ‡∏≤"], answer: 2 },
            { q: "‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏•‡∏°‡∏Ñ‡∏∑‡∏≠", options: ["‡∏™‡∏†‡∏≤‡∏û‡∏†‡∏π‡∏°‡∏¥‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®", "‡∏™‡∏†‡∏≤‡∏û‡∏†‡∏π‡∏°‡∏¥‡∏≠‡∏≤‡∏Å‡∏≤‡∏®", "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏•‡∏°", "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà"], answer: 2 },
            { q: "‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏°‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏•‡∏°‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡πÉ‡∏î", options: ["2.5-5 ‡πÄ‡∏°‡∏ï‡∏£‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ", "5 ‡πÄ‡∏°‡∏ï‡∏£‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ", "10 ‡πÄ‡∏°‡∏ï‡∏£‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ", "‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ 25 ‡πÄ‡∏°‡∏ï‡∏£‡∏ï‡πà‡∏≠‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ"], answer: 0 },
            { q: "‡πÅ‡∏´‡∏•‡πà‡∏á‡∏®‡∏±‡∏Å‡∏¢‡∏†‡∏≤‡∏û‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏•‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Ç‡∏≠‡∏á‡πÑ‡∏ó‡∏¢ ‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡πÉ‡∏î", options: ["‡∏ä‡∏≤‡∏¢‡∏ù‡∏±‡πà‡∏á ‡∏à.‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä", "‡∏î‡∏≠‡∏¢‡∏≠‡∏¥‡∏ô‡∏ó‡∏ô‡∏ô‡∏ó‡πå ‡∏à.‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡∏†‡∏π‡∏Å‡∏£‡∏∞‡∏î‡∏∂‡∏á ‡∏à.‡πÄ‡∏•‡∏¢", "‡πÄ‡∏Ç‡∏≤‡∏û‡∏ô‡∏°‡πÄ‡∏ö‡∏ç‡∏à‡∏≤ ‡∏à.‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà"], answer: 2 },
            { q: "‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡∏Å‡∏•‡πà‡∏≤‡∏ß‡∏ú‡∏¥‡∏î‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏±‡∏á‡∏´‡∏±‡∏ô‡∏•‡∏°", options: ["‡πÄ‡∏Å‡∏¥‡∏î‡∏°‡∏•‡∏û‡∏¥‡∏©‡∏ó‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏°‡∏≤‡∏Å", "‡πÑ‡∏°‡πà‡∏Å‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏°‡∏•‡∏û‡∏¥‡∏©", "‡∏ô‡∏Å‡∏≠‡∏≤‡∏à‡∏ö‡∏¥‡∏ô‡∏ä‡∏ô‡πÉ‡∏ö‡∏û‡∏±‡∏î", "‡πÄ‡∏Å‡∏¥‡∏î‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ó‡∏≤‡∏á‡∏™‡∏≤‡∏¢‡∏ï‡∏≤"], answer: 0 }
        ];

        let currentQuestion = 0; let score = 0; 
        // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 6 ‡∏î‡∏ß‡∏á
        let isAnimating = false;
        let timeLeft = 15; let totalTime = 15; let timerInterval;

        const questionText = document.getElementById("question-text");
        const optionsContainer = document.getElementById("options");
        const questionImage = document.getElementById("question-image"); 
        const scoreDisplay = document.getElementById("score");
        const timeDisplay = document.getElementById("time");
        const timerBar = document.getElementById("timer-bar"); 
        const livesDisplay = document.getElementById("lives");
        const qNumDisplay = document.getElementById("q-num");
        const worldDisplay = document.getElementById("world");
        const character = document.getElementById("character");
        const coin = document.getElementById("coin");
        const floatingScore = document.getElementById("floating-score");
        const obstacle = document.getElementById("obstacle");
        const gameContainer = document.getElementById("game-container");
        const root = document.documentElement;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function startGame() {
            showScreen('screen-game'); sfxBGM.play();
            currentQuestion = 0; score = 0; 
            lives = 6; // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏õ‡πá‡∏ô 6 ‡∏î‡∏ß‡∏á
            gameStartTime = Date.now();
            gameQuestions = shuffleArray([...questionsSource]); 
            updateLivesUI(); updateScore(); loadQuestion();
        }

        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = totalTime; timeDisplay.innerText = timeLeft; timeDisplay.classList.remove("time-warning");
            timerBar.style.transition = "none"; timerBar.style.width = "100%"; timerBar.style.backgroundColor = "#4CAF50";
            setTimeout(() => { timerBar.style.transition = "width 1s linear, background-color 0.5s ease"; }, 50);

            timerInterval = setInterval(() => {
                timeLeft--;
                if(timeLeft >= 0) {
                    timeDisplay.innerText = timeLeft; timerBar.style.width = ((timeLeft / totalTime) * 100) + "%";
                }
                if (timeLeft <= 5 && timeLeft > 0) {
                    timeDisplay.classList.add("time-warning"); timerBar.style.backgroundColor = "#ff4444"; 
                }
                if (timeLeft < 0) {
                    clearInterval(timerInterval); timerBar.style.width = "0%"; handleTimeOut(); 
                }
            }, 1000);
        }

        function stopTimer() { clearInterval(timerInterval); timeDisplay.classList.remove("time-warning"); timerBar.style.transition = "none"; }

        function handleTimeOut() {
            if (isAnimating) return; isAnimating = true;
            document.querySelectorAll('.option-btn').forEach(btn => btn.disabled = true);
            const correctIndex = gameQuestions[currentQuestion].answer; 
            document.querySelectorAll('.option-btn')[correctIndex].style.backgroundColor = "#4CAF50";
            document.querySelectorAll('.option-btn')[correctIndex].style.color = "white";

            playSound(sfxDamage); lives--; updateLivesUI();
            gameContainer.classList.add("shake-damage");
            setTimeout(() => gameContainer.classList.remove("shake-damage"), 500);

            if (lives <= 0) {
                questionText.innerText = "‚è∞ ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤! üíÄ"; setTimeout(() => endGame(false), 1500); 
            } else {
                questionText.innerText = "‚è∞ ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤! ‡∏û‡∏•‡∏±‡∏á‡∏•‡∏î -1 ‚ùå"; animateWalkAndJump(false);
            }
        }

        function updateLevelTheme(qIndex) {
            obstacle.className = ""; obstacle.classList.remove("squished", "hit"); obstacle.innerText = ""; 
            if (qIndex < 5) { 
                worldDisplay.innerText = "1-1"; root.style.setProperty('--bg-color', '#5c94fc'); 
                obstacle.classList.add("obs-block"); obstacle.innerText = "?";
            } else if (qIndex < 10) { 
                worldDisplay.innerText = "1-2"; root.style.setProperty('--bg-color', '#000000'); obstacle.classList.add("obs-pipe"); 
            } else if (qIndex < 15) { 
                worldDisplay.innerText = "1-3"; root.style.setProperty('--bg-color', '#ffcccc'); obstacle.classList.add("obs-stone"); 
            } else { 
                worldDisplay.innerText = "1-4"; root.style.setProperty('--bg-color', '#222222'); obstacle.classList.add("obs-boss"); 
            }
        }

        function updateLivesUI() {
            let hearts = ""; 
            // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏ß‡∏ô‡∏•‡∏π‡∏õ 6 ‡∏£‡∏≠‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á 6 ‡∏î‡∏ß‡∏á
            for (let i = 0; i < 6; i++) {
                hearts += (i < lives) ? "‚ù§Ô∏è" : "üñ§";
            }
            livesDisplay.innerText = hearts;
        }

        function loadQuestion() {
            if (currentQuestion >= gameQuestions.length) { endGame(true); return; }
            updateLevelTheme(currentQuestion);
            character.style.transition = "none"; character.style.left = "50px"; character.style.bottom = "50px"; 
            character.classList.remove("jumping-state", "walking-state");

            const q = gameQuestions[currentQuestion]; 
            questionText.innerText = q.q; qNumDisplay.innerText = currentQuestion + 1;
            
            if (q.img) {
                questionImage.src = q.img;
                questionImage.style.display = "inline-block";
                questionText.style.minHeight = "40px";
                questionText.style.marginBottom = "5px";
                questionText.style.fontSize = "18px";
            } else {
                questionImage.style.display = "none";
                questionText.style.minHeight = "50px";
                questionText.style.marginBottom = "10px";
                questionText.style.fontSize = "20px";
            }

            optionsContainer.innerHTML = "";

            q.options.forEach((opt, index) => {
                const btn = document.createElement("button");
                btn.className = "option-btn"; btn.innerText = opt;
                btn.onclick = () => checkAnswer(index, btn);
                optionsContainer.appendChild(btn);
            });
            startTimer(); 
        }

        function checkAnswer(selectedIndex, clickedBtn) {
            if (isAnimating) return; stopTimer(); isAnimating = true;

            document.querySelectorAll('.option-btn').forEach(btn => btn.disabled = true);
            const correctIndex = gameQuestions[currentQuestion].answer; 

            if (selectedIndex === correctIndex) {
                clickedBtn.style.backgroundColor = "#4CAF50"; clickedBtn.style.color = "white";
                
                // --- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö Regen ‡πÄ‡∏•‡∏∑‡∏≠‡∏î ---
                if (lives < 6) {
                    lives++;
                    updateLivesUI();
                    questionText.innerText = "‚≠ê ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! (‚ù§Ô∏è+1) ‚≠ê";
                } else {
                    questionText.innerText = "‚≠ê ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‚≠ê";
                }
                // ---------------------------------

                animateWalkAndJump(true);
            } else {
                clickedBtn.style.backgroundColor = "#F44336"; clickedBtn.style.color = "white";
                document.querySelectorAll('.option-btn')[correctIndex].style.backgroundColor = "#4CAF50";
                
                playSound(sfxDamage); lives--; updateLivesUI();
                gameContainer.classList.add("shake-damage");
                setTimeout(() => gameContainer.classList.remove("shake-damage"), 500);

                if (lives <= 0) {
                    questionText.innerText = "üíÄ ‡πÄ‡∏Å‡∏°‡πÇ‡∏≠‡πÄ‡∏ß‡∏≠‡∏£‡πå! üíÄ"; setTimeout(() => endGame(false), 1500); 
                } else {
                    questionText.innerText = "‚ùå ‡∏ú‡∏¥‡∏î! ‡∏û‡∏•‡∏±‡∏á‡∏•‡∏î -1 ‚ùå"; animateWalkAndJump(false);
                }
            }
        }

        function animateWalkAndJump(isCorrect) {
            let isBlockLevel = currentQuestion < 5; 
            
            const startLeft = 50;
            const obstacleLeft = obstacle.offsetLeft; 
            const containerWidth = gameContainer.offsetWidth; 
            const endLeft = containerWidth + 150; 
            const totalDist = endLeft - startLeft;
            const duration = 2000; 
            const speed = totalDist / duration; 
            const timeToObstacle = (obstacleLeft - startLeft) / speed;
            
            character.style.transition = `left ${duration}ms linear, bottom 0.3s ease`;
            character.style.left = `${endLeft}px`;
            character.classList.add("walking-state");

            if (isCorrect) {
                const jumpUpDuration = 300; 
                const jumpStartTime = timeToObstacle - jumpUpDuration; 

                setTimeout(() => {
                    playSound(sfxJump); 
                    character.style.bottom = "150px"; 
                    character.classList.remove("walking-state"); 
                    character.classList.add("jumping-state");
                }, jumpStartTime);

                setTimeout(() => {
                    if (isBlockLevel) {
                        playSound(sfxCoin); obstacle.classList.add("hit"); obstacle.innerText = ""; 
                        coin.classList.add("coin-pop-block"); 
                        
                        floatingScore.innerText = "+1"; floatingScore.style.bottom = "190px"; 
                        floatingScore.style.display = "block"; floatingScore.style.animation = "none";
                        void floatingScore.offsetWidth; floatingScore.style.animation = "floatUp 1s ease-out forwards";
                        score += 1; updateScore();
                    } else {
                        playSound(sfxCoin); obstacle.classList.add("squished"); coin.classList.add("coin-pop");
                        
                        floatingScore.innerText = "+1"; floatingScore.style.bottom = "120px"; 
                        floatingScore.style.display = "block"; floatingScore.style.animation = "none";
                        void floatingScore.offsetWidth; floatingScore.style.animation = "floatUp 1s ease-out forwards";
                        score += 1; updateScore();
                    }
                }, timeToObstacle);

                setTimeout(() => {
                     character.style.bottom = "50px"; 
                     character.classList.remove("jumping-state"); 
                     character.classList.add("walking-state");
                     setTimeout(() => { coin.classList.remove("coin-pop", "coin-pop-block"); floatingScore.style.display = "none"; }, 500);
                }, timeToObstacle + 200); 
            }

            setTimeout(() => { if(lives > 0) { currentQuestion++; isAnimating = false; loadQuestion(); } }, 2000);
        }

        function updateScore() { let str = score.toString(); while (str.length < 2) str = "0" + str; scoreDisplay.innerText = str; }

       // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô endGame ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö
        function endGame(isWin) {
            stopTimer(); sfxBGM.pause(); 
            if(isWin) playSound(sfxWin); else playSound(sfxGameOver);

            let myTimeUsed = Math.floor((Date.now() - gameStartTime) / 1000);
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô "‡∏£‡∏≠‡∏î" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏ï‡∏≤‡∏¢" (‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏Ñ‡∏π‡πà)
            db.ref('rooms/' + roomCode + '/players/' + myKey).update({
                score: score,
                timeUsed: myTimeUsed,
                status: isWin ? "‡∏£‡∏≠‡∏î" : "‡∏ï‡∏≤‡∏¢"
            }).then(() => {
                // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏£‡∏≠‡∏Å‡πà‡∏≠‡∏ô
                showScreen('screen-waiting');
                
                // --- üî¥ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 3: ‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å calculateAndShowLeaderboard() ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å ---
                // ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏î‡∏π‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ listener ‡πÉ‡∏ô joinLobby ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏ó‡∏ô
                // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô "‡∏£‡∏≠‡∏î/‡∏ï‡∏≤‡∏¢" ‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏û‡∏≤‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏≠‡∏á
                // ------------------------------------------------------------------
            });
        }

        function calculateAndShowLeaderboard() {
            db.ref('rooms/' + roomCode + '/players').once('value', (snapshot) => {
                let allPlayers = [];
                snapshot.forEach((child) => {
                    let p = child.val();
                    p.isMe = (p.name === myName);
                    allPlayers.push(p);
                });

                allPlayers.sort((a, b) => {
                    if (b.score !== a.score) return b.score - a.score;
                    return a.timeUsed - b.timeUsed;
                });

                if(allPlayers[0]) { 
                    document.getElementById('pod-name-1').innerText = allPlayers[0].name; 
                    document.getElementById('pod-score-1').innerHTML = `${allPlayers[0].score} <span style="font-size:10px;">(${allPlayers[0].timeUsed}s)</span>`; 
                }
                if(allPlayers[1]) { 
                    document.getElementById('pod-name-2').innerText = allPlayers[1].name; 
                    document.getElementById('pod-score-2').innerHTML = `${allPlayers[1].score} <span style="font-size:10px;">(${allPlayers[1].timeUsed}s)</span>`; 
                }
                if(allPlayers[2]) { 
                    document.getElementById('pod-name-3').innerText = allPlayers[2].name; 
                    document.getElementById('pod-score-3').innerHTML = `${allPlayers[2].score} <span style="font-size:10px;">(${allPlayers[2].timeUsed}s)</span>`; 
                }

                let tbody = "";
                for(let i = 3; i < allPlayers.length; i++) {
                    let p = allPlayers[i];
                    let rowClass = p.isMe ? "me-row" : "";
                    tbody += `<tr class="${rowClass}">
                                <td>#${i + 1}</td>
                                <td>${p.name} ${p.isMe ? '‚≠ê' : ''}</td>
                                <td>${p.score}</td>
                                <td style="font-size:14px;">${p.timeUsed}‡∏ß‡∏¥</td>
                              </tr>`;
                }
                document.getElementById('leaderboard-body').innerHTML = tbody;
                
                let myRank = allPlayers.findIndex(p => p.isMe) + 1;
                let statusMsg = document.getElementById('end-status-msg');
                if(myRank === 1) { 
                    statusMsg.innerText = "üèÜ ‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà 1 üèÜ"; statusMsg.style.color = "#ffd700"; 
                    fireConfetti(); 
                }
                else if(myRank <= 3) { 
                    statusMsg.innerText = `üéâ ‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å! ‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏¥‡∏î Top 3 (‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö ${myRank})`; statusMsg.style.color = "#4CAF50"; 
                    fireConfetti();
                }
                else { statusMsg.innerText = `‡∏à‡∏ö‡πÄ‡∏Å‡∏°! ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ${myRank}`; statusMsg.style.color = "#fff"; }

                showScreen('screen-leaderboard');
            });
        }

        function fireConfetti() {
            const canvas = document.getElementById('confetti-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            
            let particles = [];
            const colors = ['#f00', '#0f0', '#00f', '#ff0', '#0ff', '#f0f', '#fff'];

            for(let i=0; i<100; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height - canvas.height,
                    vx: Math.random() * 4 - 2,
                    vy: Math.random() * 5 + 2,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    size: Math.random() * 5 + 5
                });
            }

            function update() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles.forEach(p => {
                    p.x += p.vx; p.y += p.vy;
                    if(p.y > canvas.height) p.y = -20;
                    ctx.fillStyle = p.color; ctx.fillRect(p.x, p.y, p.size, p.size);
                });
                if(document.getElementById('screen-leaderboard').style.display === 'flex') {
                    requestAnimationFrame(update);
                }
            }
            update();
        }
    </script>
</body>
</html>